# Cleanup the generated html
rm -rf html

# Generate C++ API header of the DCE
cat ../../components/esp_modem/include/generate/esp_modem_command_declare.inc | clang++ -E -P -CC  -xc++ -I../../components/esp_modem/include -DGENERATE_DOCS  - | sed -n '1,/DCE command documentation/!p' > en/esp_modem_dce.hpp

# Generate C API header of the modem_api.h
cat ../../components/esp_modem/include/generate/esp_modem_command_declare.inc | clang -E -P -CC  -xc -I../../components/esp_modem/include -DGENERATE_DOCS  - | sed -n '1,/DCE command documentation/!p' > en/esp_modem_api_commands.h


# RST with links to C++ API
cat ../../components/esp_modem/include/generate/esp_modem_command_declare.inc | clang -E -P  -xc -I../../components/esp_modem/include -DGENERATE_DOCS -DGENERATE_RST_LINKS - | sed 's/NL/\n/g' > en/cxx_api_links.rst

build-docs --target esp32 --language en

cp -rf _build/en/esp32/html .
rm -rf _build __pycache__


# Modifes some version and target fields of index.html
echo "<script type='text/javascript'>
window.onload =(function() {
    var myAnchor = document.getElementById('version-select');
    var mySpan = document.createElement('select');
    mySpan.style.float = 'left';

    latest_ver = document.createElement('option');
    latest_ver.value = 'latest';
    latest_ver.textContent = 'latest(master)';
    mySpan.append(latest_ver);

    var myArray = ['v1.0.0''];
    for (var i = myArray.length - 1; i >= 0; i--) {
      current_ver = document.createElement('option');
      current_ver.value = myArray[i];
      current_ver.textContent = 'release-'+myArray[i];
      mySpan.append(current_ver);
    }


    myAnchor.parentNode.replaceChild(mySpan, myAnchor);
    mySpan.addEventListener('change', function() {
      window.location.href='https://docs.espressif.com/projects/esp-protocols/esp_modem/docs/'+event.target.value+'/index.html'
    });

    var myAnchor = document.getElementById('target-select');
    var mySpan = document.createElement('input');
    mySpan.style.float = 'left';
    mySpan.setAttribute('type', 'text');
    mySpan.setAttribute('maxLength', '10');
    mySpan.value = 'all targets';
    mySpan.setAttribute('disabled', true);
    myAnchor.parentNode.replaceChild(mySpan, myAnchor);

})();
</script>"  >> html/index.html
